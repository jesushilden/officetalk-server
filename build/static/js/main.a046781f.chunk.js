(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{104:function(e,t,n){},105:function(e,t,n){},106:function(e,t,n){},107:function(e,t,n){},108:function(e,t,n){},109:function(e,t,n){},110:function(e,t,n){},111:function(e,t,n){},112:function(e,t,n){},113:function(e,t,n){},114:function(e,t,n){},115:function(e,t,n){},116:function(e,t,n){},121:function(e,t){},123:function(e,t){},132:function(e,t,n){},150:function(e,t,n){"use strict";n.r(t),n.d(t,"rootstore",(function(){return te}));var r=n(1),s=n(2),c=n.n(s),o=n(30),a=n.n(o),i=(n(75),n(4)),u=n.n(i),l=n(5),f=n(7),d=n(6),j=n(37),m=(n(104),n(105),function(e){return Object(r.jsx)("div",{className:"dots ".concat(e.white&&"white"),children:Object(r.jsx)("div",{className:"snippet","data-title":".dot-hourglass",children:Object(r.jsx)("div",{className:"stage",children:Object(r.jsx)("div",{className:"dot-flashing"})})})})}),b=n(27);var v=function(e){var t=te.userStore,n=te.socketStore,c=Object(s.useState)(""),o=Object(f.a)(c,2),a=o[0],i=o[1],d=Object(s.useState)(""),j=Object(f.a)(d,2),v=j[0],p=j[1],h=Object(s.useState)(!1),O=Object(f.a)(h,2),g=O[0],x=O[1],S=Object(s.useState)("user"),k=Object(f.a)(S,2),N=k[0],w=k[1],y=function(e){return"user"===e&&"user"===N?"user-active":"organization"===e&&"organization"===N?"organization-active":""},I=function(){var r=Object(l.a)(u.a.mark((function r(){var s;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(""!==a&&""!==v){r.next=3;break}return alert("username and password required"),r.abrupt("return");case 3:return r.prev=3,x(!0),r.next=7,t.signIn(a,v);case 7:s=r.sent,n.connectToOffice(s.token,s.user.organization),e.navigateTo("office"),x(!1),r.next=19;break;case 13:r.prev=13,r.t0=r.catch(3),x(!1),p(""),alert("could not signin"),console.log(r.t0);case 19:case"end":return r.stop()}}),r,null,[[3,13]])})));return function(){return r.apply(this,arguments)}}();return Object(r.jsxs)("div",{className:"login",children:[Object(r.jsx)("div",{className:"login-title",children:"Sign in to OfficeTalk"}),Object(r.jsxs)("div",{className:"login-card block-shadow",children:[Object(r.jsxs)("div",{className:"login-card-tabs",children:[Object(r.jsxs)("div",{className:"login-card-tab ".concat(y("user")),onClick:function(){return w("user")},children:[Object(r.jsx)(b.c,{size:20}),Object(r.jsx)("div",{className:"login-tab-text",children:"User"})]}),Object(r.jsxs)("div",{className:"login-card-tab ".concat(y("organization")),onClick:function(){return w("organization")},children:[Object(r.jsx)(b.b,{size:20}),Object(r.jsx)("div",{className:"login-tab-text",children:"Organization"})]})]}),Object(r.jsxs)("div",{className:"login-input-row",children:[Object(r.jsx)("div",{className:"login-input-title"}),Object(r.jsx)("input",{placeholder:"Email",value:a,onChange:function(e){return i(e.target.value)}})]}),Object(r.jsxs)("div",{className:"login-input-row",children:[Object(r.jsx)("div",{className:"login-input-title"}),Object(r.jsx)("input",{placeholder:"Password",value:v,type:"password",onChange:function(e){return p(e.target.value)}})]}),Object(r.jsx)("div",{className:"login-input-row",children:Object(r.jsx)("div",{className:"OTButton",style:{background:"organization"===N&&"#F74040"},onClick:function(){return I()},children:g?Object(r.jsx)(m,{white:!0}):"Sign in"})})]})]})},p=(n(106),n(107),n(8)),h=Object(d.a)((function(e){var t=te.userStore,n=te.socketStore,s=te.officeStore;return Object(r.jsxs)("div",{className:"navbar block-shadow",children:[Object(r.jsxs)("div",{className:"navbar-logo",children:[Object(r.jsx)("img",{className:"navbar-logo-image",src:s.organization.logo}),Object(r.jsx)("div",{className:"navbar-office-name",children:s.organization.name})]}),Object(r.jsxs)("div",{className:"navbar-controls",children:[Object(r.jsx)("div",{className:"navbar-controls-border"}),Object(r.jsxs)("div",{className:"navbar-room",children:[Object(r.jsx)("div",{className:"navbar-room-name",children:function(){var e=s.users.find((function(e){return e.userId===t.user._id}));if(!e)return"loading...";var n=e.position.room;return-1===n?"Hallway":s.office.rooms.find((function(e){return e._id===n})).name}()}),Object(r.jsx)("div",{className:"navbar-room-title",children:"current room"})]}),Object(r.jsxs)("div",{className:"navbar-voice",onClick:function(){return t.setMuted(!t.muted),void n.emitMuted(!t.muted)},children:[t.muted?Object(r.jsx)(p.c,{size:22,className:"navbar-voice-microphone",color:"#F74040"}):Object(r.jsx)(p.b,{size:22,className:"navbar-voice-microphone",color:"#1CBF73"}),Object(r.jsx)("div",{className:"navbar-room-title",children:"microphone"})]}),Object(r.jsxs)("div",{className:"navbar-voice",onClick:function(){t.silenced?(t.setSilenced(!1),n.emitSilenced(!1)):(t.setSilenced(!0),t.setMuted(!0),n.emitSilenced(!0),n.emitMuted(!0))},children:[t.silenced?Object(r.jsx)(p.g,{size:22,className:"navbar-voice-volume",color:"#F74040"}):Object(r.jsx)(p.f,{size:22,className:"navbar-voice-volume",color:"#1CBF73"}),Object(r.jsx)("div",{className:"navbar-room-title",children:"volume"})]}),Object(r.jsxs)("div",{className:"navbar-settings",onClick:function(){return e.setShowSettings(!0)},children:[Object(r.jsx)(p.d,{size:22,className:"navbar-settings-cog",color:"#404145"}),Object(r.jsx)("div",{className:"navbar-room-title",children:"settings"})]}),Object(r.jsx)("div",{className:"navbar-controls-border"})]}),Object(r.jsxs)("div",{className:"navbar-user",children:[t.user.name,Object(r.jsx)("div",{className:"navbar-user-avatar",style:{backgroundImage:"url(".concat(t.user.avatar,")")}}),Object(r.jsx)("div",{className:"navbar-sign-out",onClick:function(){return t.signOut(),n.disconnectSocket(),void e.navigateTo("login")},children:"Sign out"})]})]})})),O=(n(108),n(109),Object(d.a)((function(e){var t=te.userStore;return Object(r.jsx)("div",{className:"message ".concat(function(){if(e.message.author._id===t.user._id)return" my-message"}()),children:Object(r.jsxs)("div",{className:"message-buble",children:[Object(r.jsx)("div",{className:"message-author",children:e.message.author.name}),Object(r.jsx)("div",{className:"message-content",children:e.message.content})]})})}))),g=Object(d.a)((function(e){var t=Object(s.useState)(""),n=Object(f.a)(t,2),c=n[0],o=n[1],a=Object(s.useState)(!1),i=Object(f.a)(a,2),d=i[0],j=i[1],v=Object(s.useState)("office"),p=Object(f.a)(v,2),h=p[0],g=p[1],x=te.officeStore,S=te.userStore,k=function(){var e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j(!0),e.next=3,x.sendMessage(c);case 3:t=e.sent,j(!1),o(""),t||window.alert("sending message failed");case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsxs)("div",{className:"chat block-shadow",children:[Object(r.jsxs)("div",{className:"chat-tabs block-shadow",children:[Object(r.jsx)("div",{className:"chat-tab ".concat("office"===h&&"chat-tab-active"),onClick:function(){return g("office")},children:"Office"}),Object(r.jsx)("div",{className:"chat-tab ".concat("room"===h&&"chat-tab-active"),onClick:function(){return g("room")},children:function(){var e=x.users.find((function(e){return e.userId===S.user._id}));if(!e)return"loading...";var t=e.position.room;return-1===t?"Hallway":x.office.rooms.find((function(e){return e._id===t})).name}()})]}),Object(r.jsx)("div",{className:"chat-messages",children:("office"===h?x.office.messages:x.roomMessages).map((function(e,t){return Object(r.jsx)(O,{message:e},t)}))}),Object(r.jsx)("div",{className:"chat-controls",children:Object(r.jsxs)("div",{className:"chat-input-container",children:[Object(r.jsx)("input",{value:c,placeholder:"Say something",onChange:function(e){return o(e.target.value)}}),Object(r.jsx)("div",{className:"chat-send",onClick:"office"===h?k:function(){j(!0),x.sendRoomMessage(c),j(!1),o("")},children:d?Object(r.jsx)(m,{}):Object(r.jsx)(b.a,{size:30})})]})})]})})),x=(n(110),n(111),Object(d.a)((function(e){var t=te.socketStore;return Object(r.jsxs)("div",{className:"room ".concat(e.first&&"first-block"," ").concat(e.last&&"last-block"," ").concat(e.bottomRoom&&"bottom-room"),id:"room".concat(e.room._id),children:[Object(r.jsx)("div",{className:"room-top",children:e.room.name}),Object(r.jsx)("div",{className:"room-content",onDoubleClick:function(n){return function(n){var r=document.getElementById("rooms").getBoundingClientRect(),s={room:e.room._id,coordinates:{x:n.clientX-r.left,y:n.clientY-r.top}};t.emitPosition(s)}(n)}}),Object(r.jsx)("div",{className:"room-bottom",children:Object(r.jsx)("div",{className:"room-door",id:"door".concat(e.room._id)})})]})}))),S=(n(112),Object(d.a)((function(e){var t=te.socketStore;return Object(r.jsx)("div",{className:"hallway ".concat(e.first&&"first-block"," ").concat(e.last&&"last-block"),onDoubleClick:function(e){return function(e){var n=document.getElementById("rooms").getBoundingClientRect(),r={room:-1,coordinates:{x:e.clientX-n.left,y:e.clientY-n.top}};t.emitPosition(r)}(e)}})}))),k=(n(113),Object(d.a)((function(e){var t=te.officeStore,n=te.userStore;return Object(r.jsx)("div",{className:"avatar",style:{top:e.user.position.coordinates.y,left:e.user.position.coordinates.x,transition:"all ".concat(e.user.transitionTime,"s linear"),border:"".concat(e.user.userId===n.user._id?"2":"1","px solid ").concat(e.user.userId===n.user._id?"#1CBF73":"black"),backgroundImage:"url(".concat(function(){var n=t.organization.employees.find((function(t){return t._id===e.user.userId}));return n?n.avatar:"laoding..."}(),")")},children:e.user.silenced?Object(r.jsx)(p.g,{size:22,className:"navbar-voice-volume",color:"#F74040"}):e.user.muted?Object(r.jsx)(p.c,{size:22,className:"navbar-voice-microphone",color:"#F74040"}):void 0})}))),N=Object(d.a)((function(){var e=te.officeStore,t=e.office.rooms.length;return Object(r.jsxs)("div",{className:"rooms",id:"rooms",children:[Object(r.jsx)("div",{className:"rooms-row",children:e.office.rooms.map((function(e,t){return t%2===0?Object(r.jsx)(x,{room:e,first:0===t}):null}))}),Object(r.jsx)(S,{}),Object(r.jsxs)("div",{className:"rooms-row",children:[e.office.rooms.map((function(e,t){return t%2===1?Object(r.jsx)(x,{room:e,bottomRoom:!0,first:1===t}):null})),t%2===1&&Object(r.jsx)("div",{className:"room-block-empty"})]}),Object(r.jsx)("div",{className:"user-layer",children:e.users.map((function(e){return Object(r.jsx)(k,{user:e},e.userId)}))})]})})),w=(n(114),function(e){return Object(r.jsxs)("div",{className:"loading",children:[Object(r.jsx)("div",{className:"loading-text",children:"Loading Office"}),Object(r.jsx)(m,{})]})}),y=(n(115),Object(d.a)((function(e){var t=te.officeStore,n=function(e){return t.users.find((function(t){return t.userId===e._id}))};return Object(r.jsxs)("div",{className:"coworkers block-shadow",style:{right:e.show?"0px":"-250px"},children:[Object(r.jsx)("div",{className:"coworkers-header",children:"Co-workers"}),Object(r.jsx)("div",{className:"coworkers-header-back",onClick:function(){return e.close()},children:Object(r.jsx)(p.a,{size:25})}),Object(r.jsx)("div",{className:"coworkers-names",children:t.organization.employees.map((function(e){return Object(r.jsxs)("div",{className:"coworkers-user",children:[Object(r.jsx)("div",{className:"coworkers-user-avatar",style:{backgroundImage:"url(".concat(e.avatar,")")}}),Object(r.jsxs)("div",{className:"coworkers-user-name ".concat(n(e)&&"user-online"),children:[" ",e.name," "]})]})}))})]})}))),I=n(31),z=n(16),M=(n(116),Object(d.a)((function(e){var t=te.userStore,n=(te.officeStore,Object(s.useState)("transparent")),c=Object(f.a)(n,2),o=c[0],a=c[1],i=Object(s.useState)(!1),d=Object(f.a)(i,2),j=d[0],b=d[1],v=Object(s.useState)(JSON.parse(JSON.stringify(t.user))),h=Object(f.a)(v,2),O=h[0],g=h[1],x=Object(s.useState)(!1),S=Object(f.a)(x,2),k=S[0],N=S[1];Object(s.useEffect)((function(){a("rgba(64, 65, 69, 0.5)")}),[]);var w=function(e,t){j||b(!0),g(Object(z.a)(Object(z.a)({},O),{},Object(I.a)({},e,t.target.value)))},y=function(){var e=Object(l.a)(u.a.mark((function e(){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(j){e.next=2;break}return e.abrupt("return");case 2:return N(!0),e.next=5,t.updateUser(O);case 5:n=e.sent,N(!1),n?b(!1):alert("could not save user");case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsx)("div",{className:"settings-background",style:{background:o},children:Object(r.jsxs)("div",{className:"settings-modal block-shadow",children:[Object(r.jsx)("div",{className:"settings-top-row",children:Object(r.jsx)(p.h,{size:25,style:{margin:"10px",cursor:"pointer"},color:"#404145",onClick:function(){return e.setShowSettings(!1)}})}),Object(r.jsxs)("div",{className:"settings-content",children:[Object(r.jsx)("div",{className:"settings-content-row",children:Object(r.jsx)("div",{className:"settings-avatar",style:{backgroundImage:"url(".concat(O.avatar,")")}})}),Object(r.jsx)("div",{className:"settings-content-row",children:Object(r.jsxs)("div",{className:"settings-input-row",children:[Object(r.jsx)("div",{className:"settings-input-label",children:"Avatar url"}),Object(r.jsx)("input",{value:O.avatar,onChange:function(e){return w("avatar",e)}})]})}),Object(r.jsx)("div",{className:"settings-content-row",children:Object(r.jsxs)("div",{className:"settings-input-row",children:[Object(r.jsx)("div",{className:"settings-input-label",children:"Name"}),Object(r.jsx)("input",{value:O.name,onChange:function(e){return w("name",e)}})]})})]}),Object(r.jsx)("div",{className:"settings-bottom-row",children:Object(r.jsx)("div",{className:"settings-save-button ".concat(j&&"unsaved-changes"),onClick:function(){return y()},children:k?Object(r.jsx)(m,{white:!0}):"Save"})})]})})}))),C=n(69),_=n.n(C),E=Object(d.a)((function(e){var t=te.officeStore,n=te.userStore,c=te.socketStore,o=Object(s.useState)(!1),a=Object(f.a)(o,2),i=a[0],d=a[1],j=Object(s.useState)(!1),m=Object(f.a)(j,2),b=m[0],v=m[1],O=Object(s.useRef)();return Object(s.useEffect)((function(){var e=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.fetchOffice(n.user.organization);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(e){var t=new _.a({initiator:!0,trickle:!1,stream:e});c.socket.on("callAccepted",(function(e){console.log("accept call"),t.signal(e)})),t.on("signal",(function(e){console.log("emiting signal"),c.socket.emit("startCall",e)})),t.on("stream",(function(e){console.log("stream received"),O.current&&(O.current.srcObject=e)}))})),e()}),[t,n]),t.office?Object(r.jsxs)("div",{className:"office",children:[Object(r.jsx)(h,{navigateTo:e.navigateTo,setShowSettings:v}),Object(r.jsxs)("div",{className:"office-body",children:[Object(r.jsx)(g,{}),Object(r.jsx)("div",{className:"office-body-scrollable",children:Object(r.jsx)(N,{})})]}),Object(r.jsxs)("div",{className:"office-toggle-coworkers",onClick:function(){return d(!i)},children:[Object(r.jsx)(p.e,{style:{marginRight:"3px"},size:18}),"Co-workers (".concat(t.organization.employees.length,")")]}),Object(r.jsx)(y,{show:i,close:function(){return d(!1)}}),b&&Object(r.jsx)(M,{setShowSettings:v}),Object(r.jsx)("video",{playsInline:!0,ref:O,autoPlay:!0,style:{height:"0px"}})]}):Object(r.jsx)(w,{})})),J=(n(132),Object(d.a)((function(){var e=te.userStore,t=te.socketStore,n=Object(s.useState)("login"),c=Object(f.a)(n,2),o=c[0],a=c[1];Object(s.useEffect)((function(){(function(){var n=Object(l.a)(u.a.mark((function n(){var r;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.checkSignIn();case 2:(r=n.sent).user&&a("office"),t.connectToOffice(r.token,r.user.organization);case 5:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}})()()}),[e]);return Object(r.jsx)("div",{className:"App",children:function(){switch(o){case"login":return Object(r.jsx)(v,{navigateTo:a});case"office":return Object(r.jsx)(E,{navigateTo:a});case"controlPanel":default:return Object(r.jsx)(v,{navigateTo:a})}}()})}))),T=n(18),R=n(3),P=n(10),B=n.n(P),F={getOrganization:function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.get("".concat("/api/organizations","/").concat(t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},U={sendOfficeMessage:function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post("".concat("/api/messages"),t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},A=function e(t){var n=this;Object(T.a)(this,e),this.rootStore=null,this.office=null,this.organization=null,this.roomMessages=[],this.users=[],this.fetchOffice=function(){var e=Object(l.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.getOrganization(t);case 2:return r=e.sent,n.organization=r,n.office=r.office,console.log("current organization:",n.organization),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.setEmployeeStates=function(e){n.users=e},this.sendRoomMessage=function(e){n.rootStore.socketStore.emitRoomMessage(e)},this.sendMessage=function(){var e=Object(l.a)(u.a.mark((function e(t){var r,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,U.sendOfficeMessage({content:t});case 3:if(!(r=e.sent)){e.next=7;break}return n.office.messages.find((function(e){return e._id===r._id}))||((s=JSON.parse(JSON.stringify(n.office))).messages.unshift(r),n.office=s),e.abrupt("return",r);case 7:e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),this.receiveMessage=function(e){if(!n.office.messages.find((function(t){return t._id===e._id}))){var t=JSON.parse(JSON.stringify(n.office));t.messages.unshift(e),n.office=t}},this.muteEmployee=function(e,t){var r=JSON.parse(JSON.stringify(n.users));r.find((function(t){return t.userId===e})).muted=t,n.users=r},this.silenceEmployee=function(e,t){var r=JSON.parse(JSON.stringify(n.users));r.find((function(t){return t.userId===e})).silenced=t,n.users=r},this.changePosition=function(e,t,r){var s=JSON.parse(JSON.stringify(n.users));s.find((function(t){return t.userId===e})).position=t,s.find((function(t){return t.userId===e})).transitionTime=r,n.users=s},this.receiveRoomMessage=function(e){n.roomMessages.find((function(t){return t._id===e._id}))||(n.roomMessages=[e].concat(n.roomMessages))},this.rootStore=t,Object(R.n)(this,{rootStore:R.o,office:R.o,organization:R.o,users:R.o,roomMessages:R.o,receiveMessage:R.f,changePosition:R.f,sendMessage:R.f,fetchOffice:R.f,setEmployeeStates:R.f,receiveRoomMessage:R.f,sendRoomMessage:R.f})},D=function(e){return new Promise((function(t){return setTimeout(t,e)}))},H=function(){var e=Object(l.a)(u.a.mark((function e(t,n,r,s){var c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=te.officeStore.users.find((function(e){return e.userId===s})),r===c.position.room){e.next=16;break}if(-1!==r){e.next=7;break}return e.next=5,L(c,t,n,r,s);case 5:e.next=14;break;case 7:if(-1!==c.position.room){e.next=12;break}return e.next=10,W(c,t,n,r,s);case 10:e.next=14;break;case 12:return e.next=14,X(c,t,n,r);case 14:e.next=18;break;case 16:return e.next=18,Y(s,t,n,r);case 18:case"end":return e.stop()}}),e)})));return function(t,n,r,s){return e.apply(this,arguments)}}(),L=function(){var e=Object(l.a)(u.a.mark((function e(t,n,r,s,c){var o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=q(c,t.position.room),e.next=3,D(1e3*o);case 3:Y(c,n,r,s);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,s,c){return e.apply(this,arguments)}}(),W=function(){var e=Object(l.a)(u.a.mark((function e(t,n,r,s){var c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=q(t.userId,s),e.next=3,D(1e3*c);case 3:Y(t.userId,n,r,s);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,s){return e.apply(this,arguments)}}(),X=function(){var e=Object(l.a)(u.a.mark((function e(t,n,r,s){var c,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=q(t.userId,t.position.room),e.next=3,D(1e3*c);case 3:return o=q(t.userId,s),e.next=6,D(1e3*o);case 6:Y(t.userId,n,r,s);case 7:case"end":return e.stop()}}),e)})));return function(t,n,r,s){return e.apply(this,arguments)}}(),Y=function(e,t,n,r){var s=te.officeStore.users.find((function(t){return t.userId===e})),c=(document.getElementById("rooms"),t),o=n,a=G(s.position.coordinates.x,s.position.coordinates.y,c,o);return te.officeStore.changePosition(e,{room:r,coordinates:{x:c,y:o}},a),a},q=function(e,t){var n=te.officeStore.users.find((function(t){return t.userId===e})),r=document.getElementById("door".concat(t)),s=r.offsetLeft+30,c=r.offsetTop,o=G(n.position.coordinates.x,n.position.coordinates.y,s,c);return te.officeStore.changePosition(e,{room:n.position.room,coordinates:{x:s,y:c}},o),o},G=function(e,t,n,r){var s=Math.abs(e-n),c=Math.abs(t-r);return.01*Math.hypot(s,c)},K=H,Q=function e(t){var n=this;Object(T.a)(this,e),this.rootStore=null,this.socket=null,this.connectToOffice=function(e,t){n.socket=j.io.connect("/".concat(t),{auth:{token:e}}),n.socket.on("message",(function(e){n.rootStore.officeStore.receiveMessage(e)})),n.socket.on("employees",(function(e){n.rootStore.officeStore.setEmployeeStates(e)})),n.socket.on("employeeState",(function(e){var t=te.officeStore.users.find((function(t){return t.userId===e.userId}));t.muted!==e.muted&&te.officeStore.muteEmployee(e.userId,e.muted),t.silenced!==e.silenced&&te.officeStore.silenceEmployee(e.userId,e.silenced),t.position!==e.position&&K(e.position.coordinates.x,e.position.coordinates.y,e.position.room,e.userId)})),n.socket.on("roomMessage",(function(e){n.rootStore.officeStore.receiveRoomMessage(e)}))},this.disconnectSocket=function(){n.socket.disconnect()},this.emitPosition=function(e){var t=te.userStore.user._id,r=JSON.parse(JSON.stringify(n.rootStore.officeStore.users.find((function(e){return e.userId===t}))));n.socket.emit("employeeState",{employeeState:Object(z.a)(Object(z.a)({},r),{},{position:e})})},this.emitMuted=function(e){var t=te.userStore.user._id,r=JSON.parse(JSON.stringify(n.rootStore.officeStore.users.find((function(e){return e.userId===t}))));n.socket.emit("employeeState",{employeeState:Object(z.a)(Object(z.a)({},r),{},{muted:e})})},this.emitSilenced=function(e){var t=te.userStore.user._id,r=JSON.parse(JSON.stringify(n.rootStore.officeStore.users.find((function(e){return e.userId===t}))));n.socket.emit("employeeState",{employeeState:Object(z.a)(Object(z.a)({},r),{},{silenced:e})})},this.emitRoomMessage=function(e){n.socket.emit("roomMessage",{content:e})},this.rootStore=t,Object(R.n)(this,{rootStore:R.o,socket:R.o,connectToOffice:R.f,disconnectSocket:R.f,emitPosition:R.f,emitMuted:R.f,emitSilenced:R.f})},V={updateEmployee:function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.put("".concat("/api/employees","/").concat(t._id),t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},Z="/api/signin",$={signInWithToken:function(){var e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post(Z);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),signInEmployee:function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post("".concat(Z,"/employee"),t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),signInOrganization:function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post("".concat(Z,"/organization"),t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),SignOut:function(){var e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a.post("".concat(Z,"/signout"));case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},ee=function e(t){var n=this;Object(T.a)(this,e),this.rootStore=null,this.user=null,this.muted=!1,this.silenced=!1,this.signIn=function(){var e=Object(l.a)(u.a.mark((function e(t,r){var s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.signInEmployee({username:t,password:r});case 2:return s=e.sent,n.user=s.user,console.log("current user:",n.user),e.abrupt("return",s);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.checkSignIn=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.signInWithToken();case 2:return t=e.sent,n.user=t.user,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)}))),this.signOut=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.SignOut();case 2:n.user=null;case 3:case"end":return e.stop()}}),e)}))),this.updateUser=function(){var e=Object(l.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.updateEmployee(t);case 3:return r=e.sent,n.user=r,e.abrupt("return",r);case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),this.setMuted=function(e){n.muted=e},this.setSilenced=function(e){n.silenced=e},this.rootStore=t,Object(R.n)(this,{rootStore:R.o,user:R.o,muted:R.o,silenced:R.o,signIn:R.f,checkSignIn:R.f,signOut:R.f,updateUser:R.f,setMuted:R.f,setSilenced:R.f})},te=new function e(){Object(T.a)(this,e),this.officeStore=new A(this),this.userStore=new ee(this),this.socketStore=new Q(this),Object(R.m)(this)};a.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)(J,{})}),document.getElementById("root"))},75:function(e,t,n){}},[[150,1,2]]]);
//# sourceMappingURL=main.a046781f.chunk.js.map